<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game - Sedona Michels</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 100px;
        }
        canvas {
            border: 2px solid navy;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .score {
            font-family: 'Comfortaa', cursive;
            color: navy;
            font-size: 24px;
            margin: 20px 0;
        }
        .instructions {
            font-family: 'Comfortaa', cursive;
            color: navy;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            max-width: 400px;
        }
        .audio-controls {
            margin-top: 15px;
            text-align: center;
        }
        .music-button {
            background-color: navy;
            color: white;
            border: none;
            padding: 8px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-family: 'Comfortaa', cursive;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .music-button:hover {
            transform: scale(1.1);
            opacity: 0.9;
        }
        .music-icon {
            font-size: 18px;
        }
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Comfortaa', cursive;
            background: repeating-linear-gradient(
                0deg,
                white,
                white 50px,
                rgba(173, 216, 230, 0.3) 50px,
                rgba(173, 216, 230, 0.3) 100px
            );
        }
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #ffffff;
            padding: 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-sizing: border-box;
            max-width: 100%;
        }
        .nav-links {
            flex-grow: 1;
            text-align: right;
            padding-right: 20px;
        }
        .navbar a {
            color: navy;
            text-decoration: none;
            padding: 10px 15px;
            font-size: 14px;
            font-family: 'Comfortaa', cursive;
            margin: 0 5px;
            transition: 0.3s;
            white-space: nowrap;
        }
        .navbar a:hover {
            background-color: #f0f0f0;
            border-radius: 3px;
        }
        .navbar a.active {
            background-color: navy;
            color: white;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-links">
            <a href="index.html">About Me</a>
            <a href="hobbies.html">Hobbies</a>
            <a href="resume.html">Resume</a>
            <a href="careers.html">Careers</a>
            <a href="discover.html">Discover</a>
            <a href="game.html" class="active">Game</a>
        </div>
    </nav>

    <div class="game-container">
        <div class="score">Score: <span id="score">0</span></div>
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div class="instructions">
            Use arrow keys to move the caterpillar.<br>
            Collect purple cupcakes to grow longer!<br>
            Don't hit the walls or yourself!
        </div>
        <div class="audio-controls">
            <button id="toggleMusic" class="music-button">
                <span class="music-icon">ðŸ”ˆ</span>
            </button>
            <audio id="gameMusic" loop preload="auto">
                <source src="MP3/game-music.mp3.mp3" type="audio/mpeg">
                <source src="files/game-music.mp3" type="audio/mpeg">
                <source src="game-music.mp3" type="audio/mpeg">
            </audio>
            <audio id="collectSound" preload="auto">
                <source src="MP3/ding.mp3" type="audio/mpeg">
                <source src="files/ding.mp3" type="audio/mpeg">
                <source src="ding.mp3" type="audio/mpeg">
            </audio>
        </div>
    </div>

    <script>
        window.onload = function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            
            const gridSize = 20;
            const tileCount = canvas.width / gridSize;
            const tileCountY = canvas.height / gridSize;
            
            let score = 0;
            let gameSpeed = 150; // milliseconds between moves
            let lastMoveTime = 0;
            let gameOver = false;
            
            let caterpillar = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
                { x: 8, y: 10 },
                { x: 7, y: 10 }
            ];
            
            let dx = 0;
            let dy = 0;
            let nextDx = 0;
            let nextDy = 0;
            
            let cupcakeX = 15;
            let cupcakeY = 15;
            
            let animationFrameId;
            
            function gameLoop(timestamp) {
                if (gameOver) {
                    showGameOver();
                    return;
                }

                animationFrameId = requestAnimationFrame(gameLoop);

                // Only move the caterpillar at fixed time intervals
                if (timestamp - lastMoveTime >= gameSpeed) {
                    // Update direction
                    dx = nextDx;
                    dy = nextDy;

                    // Move caterpillar
                    const head = { x: caterpillar[0].x + dx, y: caterpillar[0].y + dy };
                    
                    // Check wall collision
                    if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCountY) {
                        gameOver = true;
                        return;
                    }
                    
                    // Check self collision (skip the first segment since that's the current head position)
                    for (let i = 1; i < caterpillar.length; i++) {
                        if (head.x === caterpillar[i].x && head.y === caterpillar[i].y) {
                            gameOver = true;
                            return;
                        }
                    }

                    caterpillar.unshift(head);
                    
                    // Check cupcake collision
                    if (head.x === cupcakeX && head.y === cupcakeY) {
                        score += 10;
                        scoreElement.textContent = score;
                        generateCupcake();
                        gameSpeed = Math.max(50, gameSpeed - 5); // Speed up, but not faster than 50ms
                        
                        // Play collection sound
                        if (window.playCollectSound) {
                            window.playCollectSound();
                        }
                        console.log('Cupcake collected! Score:', score);
                    } else {
                        caterpillar.pop();
                    }

                    lastMoveTime = timestamp;
                }

                // Draw everything
                clearCanvas();
                drawCupcake();
                drawCaterpillar();
            }
            
            function showGameOver() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Comfortaa';
                ctx.textAlign = 'center';
                ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2);
                ctx.font = '20px Comfortaa';
                ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 40);
                ctx.fillText('Press Space to Restart', canvas.width / 2, canvas.height / 2 + 80);
            }
            
            function clearCanvas() {
                ctx.fillStyle = 'rgba(173, 216, 230, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            function drawCaterpillar() {
                caterpillar.forEach((segment, index) => {
                    // Draw pink body segments
                    ctx.fillStyle = 'pink';
                    ctx.beginPath();
                    ctx.arc(
                        segment.x * gridSize + gridSize / 2,
                        segment.y * gridSize + gridSize / 2,
                        gridSize / 2,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                    
                    // Add eyes to the head
                    if (index === 0) {
                        ctx.fillStyle = 'black';
                        const eyeOffset = 3;
                        ctx.beginPath();
                        ctx.arc(
                            segment.x * gridSize + gridSize / 2 + eyeOffset,
                            segment.y * gridSize + gridSize / 2 - eyeOffset,
                            2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(
                            segment.x * gridSize + gridSize / 2 - eyeOffset,
                            segment.y * gridSize + gridSize / 2 - eyeOffset,
                            2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                });
            }
            
            function drawCupcake() {
                ctx.fillStyle = 'purple';
                ctx.beginPath();
                ctx.arc(
                    cupcakeX * gridSize + gridSize / 2,
                    cupcakeY * gridSize + gridSize / 2,
                    gridSize / 3,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
            
            function generateCupcake() {
                // Keep generating new positions until we find one that's not on the caterpillar
                do {
                    cupcakeX = Math.floor(Math.random() * tileCount);
                    cupcakeY = Math.floor(Math.random() * tileCountY);
                } while (isOnCaterpillar(cupcakeX, cupcakeY));
            }
            
            function isOnCaterpillar(x, y) {
                return caterpillar.some(segment => segment.x === x && segment.y === y);
            }
            
            function startGame() {
                // Cancel any existing game loop
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }

                // Reset game state
                caterpillar = [
                    { x: 10, y: 10 },
                    { x: 9, y: 10 },
                    { x: 8, y: 10 },
                    { x: 7, y: 10 }
                ];
                dx = 1;  // Start moving right
                dy = 0;
                nextDx = 1;
                nextDy = 0;
                score = 0;
                gameSpeed = 150;
                gameOver = false;
                lastMoveTime = 0;
                scoreElement.textContent = '0';
                generateCupcake();
                
                // Start new game loop
                animationFrameId = requestAnimationFrame(gameLoop);
            }
            
            document.addEventListener('keydown', (e) => {
                // Prevent arrow keys from scrolling the page
                if (e.key.startsWith('Arrow')) {
                    e.preventDefault();
                }

                if (e.key === ' ' && gameOver) {
                    e.preventDefault(); // Also prevent space from scrolling
                    startGame();
                    return;
                }
                
                // Store next direction instead of changing immediately
                switch(e.key) {
                    case 'ArrowUp':
                        if (dy !== 1) {
                            nextDx = 0;
                            nextDy = -1;
                        }
                        break;
                    case 'ArrowDown':
                        if (dy !== -1) {
                            nextDx = 0;
                            nextDy = 1;
                        }
                        break;
                    case 'ArrowLeft':
                        if (dx !== 1) {
                            nextDx = -1;
                            nextDy = 0;
                        }
                        break;
                    case 'ArrowRight':
                        if (dx !== -1) {
                            nextDx = 1;
                            nextDy = 0;
                        }
                        break;
                }
            });
            
            startGame();

            // Music control setup
            const musicButton = document.getElementById('toggleMusic');
            const gameMusic = document.getElementById('gameMusic');
            const collectSound = document.getElementById('collectSound');
            const musicIcon = musicButton.querySelector('.music-icon');
            
            gameMusic.volume = 0.15; // Quieter background music
            collectSound.volume = 0.8; // Louder ding sound
            
            let musicPlaying = false;
            
            // Debug: Check if files can load
            gameMusic.addEventListener('loadeddata', () => {
                console.log('Background music loaded successfully');
            });
            
            gameMusic.addEventListener('error', (e) => {
                console.log('Background music error:', e);
                console.log('Failed to load from:', gameMusic.currentSrc || 'unknown source');
            });
            
            collectSound.addEventListener('loadeddata', () => {
                console.log('Collect sound loaded successfully');
            });
            
            collectSound.addEventListener('error', (e) => {
                console.log('Collect sound error:', e);
            });
            
            musicButton.addEventListener('click', async () => {
                console.log('Music button clicked, currently playing:', musicPlaying);
                
                if (!musicPlaying) {
                    try {
                        await gameMusic.play();
                        musicPlaying = true;
                        musicIcon.textContent = 'ðŸ”Š';
                        console.log('Music started playing');
                    } catch (error) {
                        console.log('Failed to play music:', error);
                        musicIcon.textContent = 'âŒ';
                    }
                } else {
                    gameMusic.pause();
                    gameMusic.currentTime = 0;
                    musicPlaying = false;
                    musicIcon.textContent = 'ðŸ”ˆ';
                    console.log('Music stopped');
                }
            });
            
            // Function to play collect sound
            window.playCollectSound = function() {
                try {
                    collectSound.currentTime = 0;
                    collectSound.play().catch(e => console.log('Collect sound failed:', e));
                } catch (error) {
                    console.log('Error playing collect sound:', error);
                }
            };
        };
    </script>

</body>
</html>